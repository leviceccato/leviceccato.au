---
import { getImage } from 'astro:assets'
import { type ImageMetadata } from 'astro'
import Container from './Container.astro'
import Text from './Text.astro'

interface Props {
	image: ImageMetadata
	alt: string
	width?: number
}

const avifImage = await getImage({
	src: Astro.props.image,
	width: Astro.props.width || Astro.props.image.width,
	format: 'avif',
})
---

<figure class="root">
	<picture>
		<source
			srcset={avifImage.src}
			type="image/avif"
		/>
		<img
			src={Astro.props.image.src}
			alt={Astro.props.alt}
			class="image"
		/>
	</picture>
	{
		Astro.slots.has('default') && (
			<figcaption>
				<Container>
					<Text>
						<slot />
					</Text>
				</Container>
			</figcaption>
		)
	}
</figure>

<style>
	.root {
		margin-inline: auto;
		padding-inline: var(--sizePageInlineMargin);
		inline-size: var(--sizeInlineSize);
		position: relative;
	}

	.image {
		position: absolute;
		inset: 0;
	}
</style>
